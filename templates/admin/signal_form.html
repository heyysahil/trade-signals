{% extends "admin/layout.html" %}

{% block title %}{% if signal %}Edit Signal{% else %}Add Signal{% endif %} - Admin{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="admin-page-header fade-in-on-scroll">
    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
        <div>
            <h1>{% if signal %}Edit Signal{% else %}Add New Signal{% endif %}</h1>
            <p class="admin-page-subtitle">{% if signal %}Update trading signal details{% else %}Create a new trading signal{% endif %}</p>
        </div>
        <a href="{{ url_for('admin_signals.signals') }}" class="admin-btn admin-btn-secondary">
            ‚Üê Back to Signals
        </a>
    </div>
</div>

<!-- Signal Form -->
<div class="admin-table-section fade-in-on-scroll" style="animation-delay: 0.2s;">
    <form method="POST" action="{% if signal %}{{ url_for('admin_signals.edit_signal', signal_id=signal.id) }}{% else %}{{ url_for('admin_signals.create_signal') }}{% endif %}">
        <div style="display: grid; gap: 1.5rem;">
            <div class="form-group">
                <label for="product_id">Product</label>
                <select id="product_id" name="product_id">
                    <option value="">Select Product (Optional)</option>
                    {% for product in products %}
                    <option value="{{ product.id }}" {% if signal and signal.product_id == product.id %}selected{% endif %}>
                        {{ product.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label for="symbol">Symbol / Stock *</label>
                <input 
                    type="text" 
                    id="symbol" 
                    name="symbol" 
                    required
                    value="{{ signal.symbol if signal else (form.symbol if form else '') }}"
                    placeholder="e.g., SBIN, ETHUSD, BTCUSD"
                    style="text-transform: uppercase;"
                >
            </div>

            <div class="form-group">
                <label for="exchange">Exchange</label>
                <input 
                    type="text" 
                    id="exchange" 
                    name="exchange" 
                    value="{{ signal.exchange if signal else (form.exchange if form else '') }}"
                    placeholder="e.g., NSE, COINBASE, PEPPERSTONE"
                >
            </div>

            <div class="form-group">
                <label for="signal_type">Signal Type *</label>
                <select id="signal_type" name="signal_type" required>
                    <option value="BUY" {% if signal and signal.signal_type == 'BUY' %}selected{% endif %}>BUY</option>
                    <option value="SELL" {% if signal and signal.signal_type == 'SELL' %}selected{% endif %}>SELL</option>
                </select>
            </div>

            <div class="form-group">
                <label for="entry_price">Entry Price *</label>
                <input 
                    type="number" 
                    id="entry_price" 
                    name="entry_price" 
                    required
                    step="0.01"
                    value="{{ signal.entry_price if signal else (form.entry_price if form else '') }}"
                    placeholder="Enter entry price"
                >
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div class="form-group">
                    <label for="target_price">Target Price</label>
                    <input 
                        type="number" 
                        id="target_price" 
                        name="target_price" 
                        step="0.01"
                        value="{{ signal.target_price if signal else (form.target_price if form else '') }}"
                        placeholder="Target price"
                    >
                </div>

                <div class="form-group">
                    <label for="stop_loss">Stop Loss</label>
                    <input 
                        type="number" 
                        id="stop_loss" 
                        name="stop_loss" 
                        step="0.01"
                        value="{{ signal.stop_loss if signal else (form.stop_loss if form else '') }}"
                        placeholder="Stop loss price"
                    >
                </div>
            </div>

            <div class="form-group">
                <label for="live_price">Live Price</label>
                <input 
                    type="number" 
                    id="live_price" 
                    name="live_price" 
                    step="0.01"
                    value="{{ signal.live_price if signal else (form.live_price if form else '') }}"
                    placeholder="Current market price"
                >
            </div>

            <div class="form-group">
                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                    <input 
                        type="checkbox" 
                        name="is_public" 
                        {% if signal and signal.is_public or (not signal and form and form.is_public == 'on') %}checked{% endif %}
                        style="width: auto;"
                    >
                    <span>Make Public (visible to non-subscribed users)</span>
                </label>
            </div>

            <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                <button type="submit" class="admin-btn admin-btn-primary">
                    <span>üíæ</span>
                    {% if signal %}Update Signal{% else %}Create Signal{% endif %}
                </button>
                <a href="{{ url_for('admin_signals.signals') }}" class="admin-btn admin-btn-secondary">
                    Cancel
                </a>
            </div>
        </div>
    </form>
</div>
{% endblock %}
